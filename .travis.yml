# We pretend to be C because we can't use the python support in
# travis-ci; it uses virtualenvs, they do not have numpy, scipy, matplotlib,
# and it is impractical to build them

language: c
install:
  - sudo apt-get update
  - sudo apt-get install -qq libhdf5-serial-dev
  - sudo apt-get install -qq python-dev
  - sudo apt-get install -qq python-numpy
  - sudo apt-get install -qq python-scipy
  - sudo apt-get install -qq python-networkx
  - sudo apt-get install -qq python-nose
  - sudo apt-get install -qq python-setuptools
  - sudo apt-get install -qq cython
  - sudo apt-get install -qq python-numexpr
  - sudo apt-get install -qq python-tables
  - sudo apt-get install -qq netcdf-bin libnetcdf-dev
  - sudo apt-get install -qq python-setuptools
  - sudo apt-get install -qq python-pandas
  - sudo easy_install pip

  # Currently (august 11, 2013), the latest version of netcdf4-python
  # requires at least libnetcdf4-4.1.2, whereas apt-get libnetcdf-dev
  # is installing libnetcdf4-4.1.1. We're avoiding this issue by requiring
  # the previous release of netcdf4-python. Hopefully in the future this
  # can be resolved.
  # See https://code.google.com/p/netcdf4-python/issues/detail?id=194&start=100
  # https://github.com/rmcgibbo/mdtraj/pull/151
  # https://github.com/rmcgibbo/mdtraj/issues/150
  - sudo pip install netCDF4==1.0.4

  - sudo pip install nose-performance
  - sudo pip install git+git://github.com/rmcgibbo/simtk.unit
  - sudo pip install flake8
  - sudo pip install scripttest
  - sudo pip install cffi

script:
  - sudo python setup.py -q install
  - python -c "import netCDF4; print netCDF4.__version__"
  - nosetests
  - nosetests --with-performance MDTraj/tests/performance --performance-revision=`git rev-parse HEAD`
  - curl --form "fileupload=@performance.json" http://mdtraj-performance.appspot.com
  - cat performance.json
  - flake8 --ignore=E121,E122,E123,E125,E126,E127,E128,E226,E231,E501,E712 MDTraj/ || echo ""  # don't want nonzero exit status
